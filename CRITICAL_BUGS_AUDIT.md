# –ö–†–ò–¢–ò–ß–ù–´–ô –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ô –ê–£–î–ò–¢

## 1. –ù–ê–ô–î–ï–ù–ù–´–ï –ë–ê–ì–ò (–ö–†–ò–¢–ò–ß–ù–´–ï)

### –ë–ê–ì #1: –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Å—Ç–∞—Ç—É—Å–æ–≤ –ø—Ä–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ (sync vs delivered/cancelled)
**–§–∞–π–ª:** [courierFlow.ts:L184-L205](file:///Users/keyser/Documents/trae_projects/bot%20hamburg/src/bot/flows/courierFlow.ts#L184-L205)  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –Ω–∞–∂–∞—Ç–∏–∏ ‚Äú–í—ã–¥–∞–Ω–æ/–û—Ç–º–µ–Ω–∏—Ç—å‚Äù –∏ –∑–∞–ø—É—Å–∫–µ sync –≤–æ–∑–º–æ–∂–Ω–æ —á—Ç–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –∏–∑ Sheets –∏ –∑–∞–ø–∏—Å—å –µ–≥–æ –æ–±—Ä–∞—Ç–Ω–æ –≤ SQLite.  
**–°—Ü–µ–Ω–∞—Ä–∏–π:**  
1. –ö—É—Ä—å–µ—Ä –Ω–∞–∂–∏–º–∞–µ—Ç ‚Äú–í—ã–¥–∞–Ω–æ‚Äù ‚Üí SQLite: status=delivered  
2. –ü–æ—á—Ç–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è sync ‚Üí —á–∏—Ç–∞–µ—Ç status=pending –∏–∑ Sheets  
3. sync –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç pending –æ–±—Ä–∞—Ç–Ω–æ ‚Üí –∑–∞–∫–∞–∑ —Å–Ω–æ–≤–∞ pending  
**–†–∏—Å–∫:** –í–´–°–û–ö–ò–ô  
**–ß–∞—Å—Ç–æ—Ç–∞:** –†–µ–¥–∫–æ, –Ω–æ –≤–æ–∑–º–æ–∂–Ω–∞ –≤ –ø–∏–∫–æ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã  
**–†–µ—à–µ–Ω–∏–µ:**  
```typescript
// –£–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
// –ø—Ä–∏ sync –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å delivered/cancelled
const existing = db.prepare("SELECT order_id, status FROM orders WHERE order_id = ?").get(oid) as any;
if (existing && (String(existing.status).toLowerCase() === "delivered" || String(existing.status).toLowerCase() === "cancelled")) {
  continue;
}
```
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –¥–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ ‚Äúsync_in_progress‚Äù –∏–ª–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π; –ª–∏–±–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞—Ç—å sync –Ω–∞ 1-2 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ —Å—Ç–∞—Ç—É—Å–∞.

---

### –ë–ê–ì #2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ Sheets –º–æ–∂–µ—Ç –∑–∞—Ç–∏—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –ø–∞–¥–∞—Ç—å –±–µ–∑ —Ä–µ—Ç—Ä–∞—è
**–§–∞–π–ª:** [courierFlow.ts:updateOrderInSheets:L33-L92](file:///Users/keyser/Documents/trae_projects/bot%20hamburg/src/bot/flows/courierFlow.ts#L33-L92)  
**–ü—Ä–æ–±–ª–µ–º–∞:** updatedRow —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏, –Ω–æ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö (–Ω–µ –Ω–∞–π–¥–µ–Ω order_id, auth, –∫–æ–ª–æ–Ω–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç) –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è –±–µ–∑ —Ä–µ—Ç—Ä–∞—è.  
**–°—Ü–µ–Ω–∞—Ä–∏–π:**  
1. –°—Ç—Ä–æ–∫–∞ —É–¥–∞–ª–µ–Ω–∞ –≤—Ä—É—á–Ω—É—é –∏–ª–∏ duplicate order_id  
2. Auth 403 (Key —Ñ–æ—Ä–º–∞—Ç/–¥–æ—Å—Ç—É–ø)  
3. –ó–∞–ø–∏—Å—å –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, SQLite —É–∂–µ –æ–±–Ω–æ–≤–ª—ë–Ω  
**–†–∏—Å–∫:** –í–´–°–û–ö–ò–ô  
**–ß–∞—Å—Ç–æ—Ç–∞:** –†–µ–¥–∫–æ  
**–†–µ—à–µ–Ω–∏–µ:**  
- –î–æ–±–∞–≤–∏—Ç—å retry (–¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫) –Ω–∞ get/update  
- –ü—Ä–∏ targetRowIndex === -1 ‚Üí –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏ –ø—É—à–∏—Ç—å –≤ repair-–æ—á–µ—Ä–µ–¥—å (cron ‚ÄúRepair job‚Äù)  
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–ª–æ–Ω–æ–∫ –ø–µ—Ä–µ–¥ update; –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî –Ω–µ –∑–∞—Ç–∏—Ä–∞—Ç—å, –∞ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º

---

### –ë–ê–ì #3: –û—Ç—á—ë—Ç—ã –º–æ–≥—É—Ç –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –∑–∞–∫–∞–∑—ã –±–µ–∑ delivered_timestamp
**–§–∞–π–ª:** [scheduler.ts:L17-L99](file:///Users/keyser/Documents/trae_projects/bot%20hamburg/src/infra/cron/scheduler.ts#L17-L99), [scheduler.ts:L116-L157](file:///Users/keyser/Documents/trae_projects/bot%20hamburg/src/infra/cron/scheduler.ts#L116-L157)  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ delivered_timestamp –ø—É—Å—Ç, —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è delivered_at_ms OR substr(delivered_timestamp,1,10), –Ω–æ –ø—Ä–∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö (–ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è) –≤–æ–∑–º–æ–∂–Ω–æ –≤—ã–ø–∞–¥–µ–Ω–∏–µ –∏–∑ DATE-–ª–æ–≥–∏–∫–∏.  
**–°—Ü–µ–Ω–∞—Ä–∏–π:**  
1. –ó–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω, delivered_timestamp –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (—Ç–æ–ª—å–∫–æ delivered_at_ms)  
2. DATE() –Ω–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–∞—Ä—Å–∏—Ç ISO –ø—Ä–∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Ñ–æ—Ä–º–∞—Ç—É  
**–†–∏—Å–∫:** –°–†–ï–î–ù–ò–ô  
**–ß–∞—Å—Ç–æ—Ç–∞:** –†–µ–¥–∫–æ  
**–†–µ—à–µ–Ω–∏–µ:**  
- –ù–∞ —É—Ä–æ–≤–Ω–µ –∑–∞–ø–∏—Å–µ–π –ø–∏—Å–∞—Ç—å delivered_at_ms (UTC ms) –≤—Å–µ–≥–¥–∞  
- –í –æ—Ç—á—ë—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å delivered_at_ms –¥–∏–∞–ø–∞–∑–æ–Ω—ã –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é; ISO ‚Äî –∫–∞–∫ fallback

---

## 2. –ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–´–ï –ë–ê–ì–ò (–¢–†–ï–ë–£–Æ–¢ –ü–†–û–í–ï–†–ö–ò)

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –±–∞–≥ #1: order_id –≤ Sheets –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º/—Å—Ç—Ä–æ–∫–æ–≤—ã–º
**–§–∞–π–ª:** [courierFlow.ts:syncOrdersFromSheets:L60-L116](file:///Users/keyser/Documents/trae_projects/bot%20hamburg/src/bot/flows/courierFlow.ts#L60-L116)  
**–ü—Ä–æ–±–ª–µ–º–∞:** Number(row[idIdx]) –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å NaN  
**–†–µ—à–µ–Ω–∏–µ:**  
```typescript
const oidRaw = idIdx >= 0 ? r[idIdx] : "";
const oid = Number(oidRaw);
if (!Number.isFinite(oid)) { console.log("‚ö†Ô∏è Invalid order_id", oidRaw); continue; }
```

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –±–∞–≥ #2: items-–∫–æ–ª–æ–Ω–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ‚Üí –ø—É—Å—Ç—ã–µ —Ç–æ–≤–∞—Ä—ã
**–§–∞–π–ª:** [courierFlow.ts:L68-L74](file:///Users/keyser/Documents/trae_projects/bot%20hamburg/src/bot/flows/courierFlow.ts#L68-L74)  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –Ω–µ—Ç –Ω–∏ ‚Äúitems (JSON)‚Äù –Ω–∏ ‚Äúitems‚Äù, itemsRaw –±—É–¥–µ—Ç ‚Äú[]‚Äù  
**–†–µ—à–µ–Ω–∏–µ:** –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏ –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è fallback –∏–∑ SQLite –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π –∑–∞–ø–∏—Å–∏

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –±–∞–≥ #3: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ ‚Üí –ø–æ—Ç–µ—Ä—è –ø–∞–Ω–µ–ª–∏ –±–µ–∑ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ü–∏–∏
**–§–∞–π–ª:** [courierFlow.ts:refresh + persistence:L276-L371](file:///Users/keyser/Documents/trae_projects/bot%20hamburg/src/bot/flows/courierFlow.ts#L276-L371)  
**–ü—Ä–æ–±–ª–µ–º–∞:** –†–∞–Ω–µ–µ ‚Äî –ø–æ—Ç–µ—Ä—è panel id; —Å–µ–π—á–∞—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ SQLite courier_panels

---

## 3. –õ–û–ì–ò–ß–ï–°–ö–ò–ï –ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–Ø

### –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ #1: –†–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏—Å—Ç–∏–Ω—ã (SQLite vs Sheets)
**–ú–µ—Å—Ç–∞:**  
- [courierFlow.ts:syncOrdersFromSheets](file:///Users/keyser/Documents/trae_projects/bot%20hamburg/src/bot/flows/courierFlow.ts#L60-L116)  
- [courierFlow.ts:updateOrderInSheets](file:///Users/keyser/Documents/trae_projects/bot%20hamburg/src/bot/flows/courierFlow.ts#L33-L92)  
**–ü—Ä–æ–±–ª–µ–º–∞:** –õ–æ–∫–∞–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –∏ Sheets –º–æ–≥—É—Ç —Ä–∞—Å—Ö–æ–¥–∏—Ç—å—Å—è –ø—Ä–∏ —Å–±–æ—è—Ö –∑–∞–ø–∏—Å–∏.  
**–†–µ—à–µ–Ω–∏–µ:** –ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ cron ‚ÄúRepair job‚Äù –¥–æ–ø–∏—Å–∞—Ç—å –ø–æ–≤—Ç–æ—Ä commitDelivery –∏ commitCancel; –¥–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ ‚Äúsheets_committed‚Äù.

---

## 4. RACE CONDITIONS

### Race #1: sync –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∑–∞—â–∏—Ç–æ–π delivered/cancelled –ø—Ä–∏ sync.  
**–†–µ—à–µ–Ω–∏–µ:** –û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É; –¥–æ–±–∞–≤–∏—Ç—å –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–π –ª–æ–∫ –Ω–∞ –≤—Ä–µ–º—è updateOrderInSheets (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–µ—Ç–∫–∞ –≤ –ë–î –Ω–∞ 2‚Äì3 —Å–µ–∫).

### Race #2: –î–≤–∞ –∫—É—Ä—å–µ—Ä–∞ –∂–º—É—Ç —Ä–∞–∑–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å; –≤ Sheets –≤–æ–∑–º–æ–∂–Ω–∞ –≥–æ–Ω–∫–∞.  
**–†–µ—à–µ–Ω–∏–µ:** –ù–∞ —É—Ä–æ–≤–Ω–µ –ë–î –≤–µ—Å—Ç–∏ audit trail; –Ω–∞ —É—Ä–æ–≤–Ω–µ UI ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –æ–¥–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ (disable –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–∫–∞).

### Race #3: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ + sync
**–û–ø–∏—Å–∞–Ω–∏–µ:** sync –Ω–µ –≤–∏–¥–∏—Ç –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑, –ø–æ–∫–∞ –Ω–µ –∑–∞–ø–∏—Å–∞–Ω –≤ Sheets; –≤ —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—É—Å–∫ —É–≤–∏–¥–∏—Ç.  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–ø—É—Å—Ç–∏–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ; –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ—Ä–æ—Ç–∫—É—é –∑–∞–¥–µ—Ä–∂–∫—É –ø–µ—Ä–µ–¥ sync –ø–æ—Å–ª–µ commitOrderToSheets.

---

## 5. EDGE CASES –ë–ï–ó –û–ë–†–ê–ë–û–¢–ö–ò

### Edge case #1: items_json = null/undefined/''/'null'
**–ú–µ—Å—Ç–∞:**  
- [scheduler.ts:L60-L67](file:///Users/keyser/Documents/trae_projects/bot%20hamburg/src/infra/cron/scheduler.ts#L60-L67)  
- [adminFlow.ts:L177-L238](file:///Users/keyser/Documents/trae_projects/bot%20hamburg/src/bot/flows/adminFlow.ts#L177-L238)  
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –í–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥: `JSON.parse(String(items_json || "[]"))`

### Edge case #2: product_id –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ 0
**–†–µ—à–µ–Ω–∏–µ:** normalizeProductId —Å fallback; –∏–º—è: `–¢–æ–≤–∞—Ä #ID`

### Edge case #3: quantity = 0
**–†–µ—à–µ–Ω–∏–µ:** —Ç—Ä–∞–∫—Ç–æ–≤–∞—Ç—å –∫–∞–∫ 0 (–Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É) –∏–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ 1 ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫–∏; —Å–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è qty||quantity||1 –≤ –ø–∞–Ω–µ–ª–∏, –∞ –≤ –æ—Ç—á—ë—Ç–∞—Ö ‚Äî —è–≤–Ω–æ–µ —á—Ç–µ–Ω–∏–µ quantity/qty

### Edge case #4: price = null/NaN
**–†–µ—à–µ–Ω–∏–µ:** fallback –Ω–∞ price –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ (adminFlow —É–∂–µ –¥–µ–ª–∞–µ—Ç —á–µ—Ä–µ–∑ priceMap)

---

## 6. –ü–†–û–ë–õ–ï–ú–´ –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò

### –ü—Ä–æ–±–ª–µ–º–∞ #1: N+1 –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–æ–≤
**–ú–µ—Å—Ç–∞:**  
- –í—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è —Ä–µ–¥–∫–æ; –∞–¥–º–∏–Ω ‚Äú–ü—Ä–æ–¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã‚Äù –≥—Ä—É–∑–∏—Ç –∫–∞—Ä—Ç—É –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∑–∞—Ä–∞–Ω–µ–µ  
**–†–µ—à–µ–Ω–∏–µ:** –í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å Map –∏ –Ω–µ —Ö–æ–¥–∏—Ç—å –ø–æ –æ–¥–Ω–æ–º—É –ø—Ä–æ–¥—É–∫—Ç—É –≤ —Ü–∏–∫–ª–µ

### –ü—Ä–æ–±–ª–µ–º–∞ #2: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã Sheets
**–ú–µ—Å—Ç–∞:**  
- syncOrdersFromSheets –¥–µ–ª–∞–µ—Ç –æ–¥–∏–Ω batchGet  
**–†–µ—à–µ–Ω–∏–µ:** –û–∫; –¥–ª—è –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç ‚Äî –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –∏–ª–∏ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å (utils/products —É–∂–µ –∫–µ—à–∏—Ä—É–µ—Ç –∫–∞—Ä—Ç—É –ø–æ –≥–æ—Ä–æ–¥—É)

---

## 7. –ö–†–ò–¢–ò–ß–ù–û–°–¢–¨ –ü–û –ü–†–ò–û–†–ò–¢–ï–¢–ê–ú

**üî¥ –ö–†–ò–¢–ò–ß–ù–û:**
1. –ó–∞—â–∏—Ç–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø—Ä–∏ sync (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –¥–µ—Ä–∂–∞—Ç—å)  
2. –ù–∞–¥—ë–∂–Ω–∞—è –∑–∞–ø–∏—Å—å –≤ Sheets —Å retry –∏ repair‚Äë–æ—á–µ—Ä–µ–¥—å—é  

**üü° –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢:**
1. delivered_timestamp/delivered_at_ms ‚Äî —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ ms  
2. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è product_id –≤–µ–∑–¥–µ –∏ –∫–∞—Ä—Ç–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –µ–¥–∏–Ω–∞—è  

**üü¢ –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢:**
1. –¢–µ—Å—Ç—ã –Ω–∞ –æ—Ç—á—ë—Ç—ã –∏ sync  
2. –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç –ø–∞–Ω–µ–ª–∏

---

## 8. –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∞–≥–∏ (–°–ï–ô–ß–ê–°)
- [ ] –î–æ–±–∞–≤–∏—Ç—å retry(3) –≤ updateOrderInSheets –∏ repair‚Äë–æ—á–µ—Ä–µ–¥—å (cron) –ø—Ä–∏ –æ—à–∏–±–∫–µ  
- [ ] –ü–∏—Å–∞—Ç—å delivered_at_ms –≤—Å–µ–≥–¥–∞ –∏ –æ—Ç—á—ë—Ç —Å—á–∏—Ç–∞—Ç—å –ø–æ ms‚Äë–¥–∏–∞–ø–∞–∑–æ–Ω–∞–º

### –§–∞–∑–∞ 2: –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–ó–ê–í–¢–†–ê)
- [ ] –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å product_id –ø—Ä–∏ –≤—Å–µ—Ö –∑–∞–ø–∏—Å—è—Ö/—á—Ç–µ–Ω–∏—è—Ö items_json  
- [ ] –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å —á—Ç–µ–Ω–∏–µ Sheets —á–µ—Ä–µ–∑ SheetsClient

### –§–∞–∑–∞ 3: –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞
- [ ] –Æ–Ω–∏—Ç‚Äë—Ç–µ—Å—Ç—ã –¥–ª—è sync, –æ—Ç—á—ë—Ç–æ–≤, –ø–∞–Ω–µ–ª–∏ –∏ updateOrderInSheets  
- [ ] –õ–æ–∫ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ –Ω–∞ 2‚Äì3 —Å–µ–∫—É–Ω–¥—ã (–º–µ—Ç–∫–∞ –≤ –ë–î)  

---

## 9. –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ù–ê–ë–õ–Æ–î–ï–ù–ò–Ø
- –ü–∞–Ω–µ–ª—å –∫—É—Ä—å–µ—Ä–∞ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞: [courierFlow.ts:L276-L371](file:///Users/keyser/Documents/trae_projects/bot%20hamburg/src/bot/flows/courierFlow.ts#L276-L371)  
- –ê–¥–º–∏–Ω ‚Äú–ü—Ä–æ–¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã‚Äù –∏—Å–ø–æ–ª—å–∑—É–µ—Ç utils/products: [adminFlow.ts:L177-L238](file:///Users/keyser/Documents/trae_projects/bot%20hamburg/src/bot/flows/adminFlow.ts#L177-L238)  
- –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–≤–æ–¥–∫–∞: –¥–∞—Ç–∞ override –∏ –µ–¥–∏–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è: [scheduler.ts:L17-L99](file:///Users/keyser/Documents/trae_projects/bot%20hamburg/src/infra/cron/scheduler.ts#L17-L99)

